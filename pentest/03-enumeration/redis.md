# üóÑÔ∏è √ânum√©ration Redis

[‚Üê Retour √† la table des mati√®res](../README.md)

## Port par d√©faut : 6379

Redis (Remote Dictionary Server) est une base de donn√©es NoSQL en m√©moire, souvent utilis√©e pour du caching et des sessions. En CTF, Redis mal configur√© peut exposer des flags ou des informations sensibles.

## Connexion au serveur Redis

### Connexion basique
```bash
# Connexion simple
redis-cli -h <HOST> -p <PORT>

# Avec authentification
redis-cli -h <HOST> -p <PORT> -a <PASSWORD>
```

### Test de connectivit√©
```bash
# Tester la connexion
redis-cli -h <HOST> -p <PORT> PING
# R√©ponse attendue : PONG
```

## √ânum√©ration des bases de donn√©es

### Changer de base
```bash
# Redis a plusieurs bases (0 √† 15 par d√©faut)
SELECT 0   # Choisir la base 0
SELECT 1   # Choisir la base 1
```

### Lister les cl√©s
```bash
# Compter les cl√©s dans la base courante
DBSIZE

# Lister toutes les cl√©s (‚ö†Ô∏è peut √™tre lent sur de grosses bases)
KEYS *

# Exemple de sortie :
# 1) "numb"
# 2) "temp"
# 3) "stor"
# 4) "flag"
```

### D√©terminer le type d'une cl√©
```bash
# Conna√Ætre le type de donn√©es stock√©
TYPE <cl√©>

# R√©sultats possibles :
# string, list, set, zset, hash, stream
```

## R√©cup√©ration des donn√©es

### String (cha√Æne de caract√®res)
```bash
# Afficher la valeur
GET <cl√©>

# Exemple :
GET flag
```

### List (liste)
```bash
# Afficher tous les √©l√©ments d'une liste
LRANGE <cl√©> 0 -1

# Exemple :
LRANGE user_list 0 -1
```

### Hash (dictionnaire)
```bash
# Afficher tous les champs et valeurs d'un hash
HGETALL <cl√©>

# Exemple :
HGETALL user_data
```

### Set (ensemble)
```bash
# Afficher tous les membres d'un set
SMEMBERS <cl√©>

# Exemple :
SMEMBERS permissions
```

## Informations syst√®me

### Informations du serveur
```bash
# Obtenir toutes les infos et stats du serveur
INFO

# Sections sp√©cifiques :
INFO server      # Informations serveur
INFO clients     # Clients connect√©s
INFO memory      # Utilisation m√©moire
INFO stats       # Statistiques
```

### Configuration
```bash
# Afficher la configuration
CONFIG GET *

# Param√®tre sp√©cifique
CONFIG GET requirepass  # V√©rifier si un mot de passe est requis
```

## Commandes utiles en CTF

### Workflow d'√©num√©ration complet
```bash
# 1. Connexion
redis-cli -h <HOST> -p <PORT>

# 2. Tester l'authentification
PING

# 3. Lister les bases
INFO keyspace

# 4. Pour chaque base, √©num√©rer les cl√©s
SELECT 0
DBSIZE
KEYS *

# 5. Pour chaque cl√©, v√©rifier le type
TYPE flag

# 6. R√©cup√©rer la valeur selon le type
GET flag
# ou LRANGE, HGETALL, SMEMBERS selon le type
```

### Commandes depuis le shell (sans entrer dans le prompt)
```bash
# Afficher le nombre de cl√©s
redis-cli -h <HOST> -p <PORT> DBSIZE

# Lister les cl√©s
redis-cli -h <HOST> -p <PORT> KEYS '*'

# R√©cup√©rer directement une valeur
redis-cli -h <HOST> -p <PORT> GET flag

# Avec authentification
redis-cli -h <HOST> -p <PORT> -a <PASSWORD> GET flag
```

## Exploitation

### Commandes dangereuses (si acc√®s admin)
```bash
# Supprimer toutes les cl√©s de la base courante
FLUSHDB

# Supprimer toutes les cl√©s de toutes les bases
FLUSHALL

# ‚ö†Ô∏è √Ä utiliser avec pr√©caution !
```

### √ânum√©ration des bases de donn√©es
```bash
# Lister toutes les bases non-vides
INFO keyspace

# Exemple de sortie :
# db0:keys=4,expires=0
# db1:keys=2,expires=0
```

## Astuces CTF

### Script rapide pour √©num√©rer toutes les bases
```bash
#!/bin/bash
HOST="target_ip"
PORT="6379"

for db in {0..15}; do
    echo "=== DATABASE $db ==="
    redis-cli -h $HOST -p $PORT -n $db KEYS '*'
done
```

### Recherche automatique de flags
```bash
# Chercher les cl√©s contenant "flag"
redis-cli -h <HOST> -p <PORT> KEYS '*flag*'

# Parcourir toutes les bases
for i in {0..15}; do
    echo "DB $i:"
    redis-cli -h <HOST> -p <PORT> -n $i KEYS '*flag*'
done
```

## Metasploit Modules

### Scanner Redis
```bash
# Module de scan Redis
use auxiliary/scanner/redis/redis_server

set RHOSTS target_ip
set RPORT 6379
run
```

### Exploitation
```bash
# Module pour dumper les cl√©s Redis
use auxiliary/scanner/redis/redis_login
set RHOSTS target_ip
run
```

## S√©curisation (pour r√©f√©rence)

### Bonnes pratiques
- **Authentification** : Toujours configurer `requirepass`
- **Bind** : Ne pas exposer sur 0.0.0.0, utiliser 127.0.0.1
- **Firewall** : Restreindre l'acc√®s par IP
- **Commandes dangereuses** : D√©sactiver avec `rename-command`

### Test de configuration vuln√©rable
```bash
# V√©rifier si pas d'authentification requise
redis-cli -h target_ip INFO

# Si √ßa fonctionne sans mot de passe ‚Üí vuln√©rable !
```
